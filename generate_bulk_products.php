<?php
/**
 * ุฅุถุงูุฉ ููุชุฌุงุช ุจูููุงุช ูุจูุฑุฉ ูุงุฎุชุจุงุฑ ุฃุฏุงุก ุงููุธุงู
 * ูุถูู 250 ููุชุฌ ููู ุชุตููู ูุน ุตูุฑ ูุฃุณุนุงุฑ ููุตู
 */

$dbPath = __DIR__ . '/database/database.sqlite';
$pdo = new PDO('sqlite:' . $dbPath);
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

$uploadsDir = __DIR__ . '/public/uploads/products';
if (!is_dir($uploadsDir)) {
    mkdir($uploadsDir, 0755, true);
}

echo "==============================================\n";
echo "   ุฅุถุงูุฉ ููุชุฌุงุช ุจูููุงุช ูุจูุฑุฉ ูุงุฎุชุจุงุฑ ุงูุฃุฏุงุก\n";
echo "==============================================\n\n";

// ุฌูุจ ุฌููุน ุงูุชุตูููุงุช
$categories = $pdo->query("SELECT id, name FROM categories ORDER BY id")->fetchAll(PDO::FETCH_ASSOC);

echo "๐ ุงูุชุตูููุงุช ุงูููุฌูุฏุฉ: " . count($categories) . "\n\n";

// ููุงุฆู ุงููููุงุช ูุชูููุฏ ุฃุณูุงุก ุงูููุชุฌุงุช
$brands = [
    'ุฃุฌูุฒุฉ ููุฒููุฉ' => ['ุณุงูุณููุฌ', 'LG', 'ุชูุดูุจุง', 'ุดุงุฑุจ', 'ุจุงูุงุณูููู', 'ููููุจุณ', 'ุจูุด', 'ุณูููุฒ', 'ููุชุงุดู', 'ูููู'],
    'ุจูุชุงุฌุงุฒุงุช' => ['ูููููุฑุณุงู', 'ูุฑูุด', 'ุงู ููู', 'ูุงุฌูุฑูุงููุง', 'ุฌููู ุบุงุฒ', 'ุชูููุฌุงุฒ', 'ูุงูุช ููู', 'ูุฑูุงุฒู'],
    'ุชููููุงุช' => ['ุดุงุฑุจ', 'ูุงุฑููุฑ', 'ูููููู ุงูุฑ', 'LG', 'ุณุงูุณููุฌ', 'ุฌุฑู', 'ููุฏูุง', 'ุชูุฑููุฏู', 'ูุงูุณูุณ'],
    'ุชููุฒูููุงุช' => ['ุณุงูุณููุฌ', 'LG', 'ุณููู', 'ุชูุดูุจุง', 'TCL', 'ูุงูุณูุณ', 'ููููุจุณ', 'ุดุงุฑุจ', 'ุจุงูุงุณูููู'],
    'ุซูุงุฌุงุช' => ['ุชูุดูุจุง', 'ุดุงุฑุจ', 'LG', 'ุณุงูุณููุฌ', 'ูุฑูุงุฒู', 'ุงูุงุณูุง', 'ูุฑูุด', 'ูุงูุช ููู', 'ุจููู'],
    'ุณุฎุงูุงุช' => ['ุงููููุจูู', 'ุชูุฑููุฏู', 'ูุฑูุด', 'ุงุฑูุณุชูู', 'ูุงูุช ุจูููุช', 'ูููููู', 'ูุฑูุงุฒู', 'ุจูุด'],
    'ุบุณุงูุงุช' => ['ุณุงูุณููุฌ', 'LG', 'ุชูุดูุจุง', 'ุฒุงููุณู', 'ูุงูุช ุจูููุช', 'ุดุงุฑุจ', 'ุจูุด', 'ุงูุฏูุงู', 'ุจููู'],
    'ูุงุจุชูุจุงุช' => ['HP', 'Dell', 'Lenovo', 'ASUS', 'Acer', 'Apple', 'MSI', 'Toshiba', 'Samsung', 'Microsoft'],
    'ููุจุงููุงุช' => ['Apple', 'Samsung', 'Xiaomi', 'Oppo', 'Realme', 'Huawei', 'Vivo', 'Honor', 'Google', 'OnePlus'],
    'ูููุฑูููู' => ['ุณุงูุณููุฌ', 'LG', 'ุดุงุฑุจ', 'ุจุงูุงุณูููู', 'ุจูุงู ุงูุฏ ุฏููุฑ', 'ุชูุฑููุฏู', 'ูููููุฏ', 'ูุฑูุด'],
    'ุฃุฌูุฒุฉ ููุฑุจุงุฆูุฉ' => ['ููููุจุณ', 'ุจุฑุงูู', 'ููููููุณ', 'ูููููุฏ', 'ุจูุงู ุงูุฏ ุฏููุฑ', 'ุชููุงู', 'ุฑุงุณู ููุจุฒ'],
    'ููุงุชู ูุญูููุฉ' => ['Apple', 'Samsung', 'Xiaomi', 'Oppo', 'Realme', 'Huawei', 'Vivo', 'Honor', 'Nokia'],
    'ููุญูุงุช' => ['ุณุงูุณููุฌ', 'Apple', 'Anker', 'Belkin', 'JBL', 'Sony', 'Logitech', 'Baseus', 'Ugreen'],
    'ุฃุฌูุฒุฉ ูุทุจุฎ' => ['ูููููุฏ', 'ููููููุณ', 'ุจุฑุงูู', 'ุจูุงู ุงูุฏ ุฏููุฑ', 'ููููุจุณ', 'ูููุชุฑู', 'ูููุฌุง', 'ููููุชูู'],
    'ุดุงุดุงุช ูุชููุฒูููุงุช' => ['ุณุงูุณููุฌ', 'LG', 'ุณููู', 'ุชูุดูุจุง', 'TCL', 'ูุงูุณูุณ', 'ููููุจุณ', 'BenQ', 'ViewSonic'],
    'ุซูุงุฌุงุช ููุฌูุฏุงุช' => ['ุชูุดูุจุง', 'ุดุงุฑุจ', 'LG', 'ุณุงูุณููุฌ', 'ูุฑูุงุฒู', 'ุงูุงุณูุง', 'ูุฑูุด', 'ูุงูุช ููู'],
    'ููููุงุช' => ['ุดุงุฑุจ', 'ูุงุฑููุฑ', 'ูููููู ุงูุฑ', 'LG', 'ุณุงูุณููุฌ', 'ุฌุฑู', 'ููุฏูุง', 'ุฏุงููู', 'ููุชุณูุจูุดู'],
];

$defaultBrands = ['ุณุงูุณููุฌ', 'LG', 'ุชูุดูุจุง', 'ุดุงุฑุจ', 'ููููุจุณ', 'ุณููู', 'ุจุฑุงูู', 'ุจูุด'];

$productTypes = [
    'ุฃุฌูุฒุฉ ููุฒููุฉ' => ['ุฎูุงุท', 'ูููุณุฉ ููุฑุจุงุก', 'ูููุงุฉ ุจุฎุงุฑ', 'ูุงูููุฉ ูููุฉ', 'ุนุตุงุฑุฉ', 'ููุฑูุฉ', 'ูุจุฉ', 'ุบูุงูุฉ', 'ุชูุณุชุฑ'],
    'ุจูุชุงุฌุงุฒุงุช' => ['ุจูุชุงุฌุงุฒ 4 ุดุนูุฉ', 'ุจูุชุงุฌุงุฒ 5 ุดุนูุฉ', 'ุจูุชุงุฌุงุฒ ุจูุช ุงู', 'ูุฑู ุบุงุฒ', 'ูุณุทุญ ุบุงุฒ'],
    'ุชููููุงุช' => ['ุชูููู 1.5 ุญุตุงู', 'ุชูููู 2.25 ุญุตุงู', 'ุชูููู 3 ุญุตุงู', 'ุชูููู ุงููุฑุชุฑ', 'ุชูููู ุณุจููุช', 'ุชูููู ุดุจุงู'],
    'ุชููุฒูููุงุช' => ['ุชููุฒููู 32 ุจูุตุฉ', 'ุชููุฒููู 43 ุจูุตุฉ', 'ุชููุฒููู 50 ุจูุตุฉ', 'ุชููุฒููู 55 ุจูุตุฉ', 'ุชููุฒููู 65 ุจูุตุฉ', 'ุชููุฒููู 75 ุจูุตุฉ'],
    'ุซูุงุฌุงุช' => ['ุซูุงุฌุฉ 12 ูุฏู', 'ุซูุงุฌุฉ 14 ูุฏู', 'ุซูุงุฌุฉ 16 ูุฏู', 'ุซูุงุฌุฉ 18 ูุฏู', 'ุซูุงุฌุฉ 20 ูุฏู', 'ุซูุงุฌุฉ 24 ูุฏู'],
    'ุณุฎุงูุงุช' => ['ุณุฎุงู ุบุงุฒ 6 ูุชุฑ', 'ุณุฎุงู ุบุงุฒ 10 ูุชุฑ', 'ุณุฎุงู ููุฑุจุงุก 40 ูุชุฑ', 'ุณุฎุงู ููุฑุจุงุก 50 ูุชุฑ', 'ุณุฎุงู ููุฑุจุงุก 80 ูุชุฑ', 'ุณุฎุงู ููุฑู'],
    'ุบุณุงูุงุช' => ['ุบุณุงูุฉ 7 ูููู', 'ุบุณุงูุฉ 8 ูููู', 'ุบุณุงูุฉ 9 ูููู', 'ุบุณุงูุฉ 10 ูููู', 'ุบุณุงูุฉ 12 ูููู', 'ุบุณุงูุฉ ุชุญููู ุนููู'],
    'ูุงุจุชูุจุงุช' => ['ูุงุจุชูุจ 14 ุจูุตุฉ', 'ูุงุจุชูุจ 15.6 ุจูุตุฉ', 'ูุงุจุชูุจ 17 ุจูุตุฉ', 'ูุงุจุชูุจ ุฌูููุฌ', 'ูุงุจุชูุจ ุงูุชุฑุงุจูู', 'ูุงุจุชูุจ 2 ูู 1'],
    'ููุจุงููุงุช' => ['ููุจุงูู 64GB', 'ููุจุงูู 128GB', 'ููุจุงูู 256GB', 'ููุจุงูู 512GB', 'ููุจุงูู 5G', 'ููุจุงูู ูููุฏุงุจู'],
    'ูููุฑูููู' => ['ูููุฑูููู 20 ูุชุฑ', 'ูููุฑูููู 25 ูุชุฑ', 'ูููุฑูููู 30 ูุชุฑ', 'ูููุฑูููู 40 ูุชุฑ', 'ูููุฑูููู ุฌุฑูู', 'ูููุฑูููู ูููููุดู'],
    'ุฃุฌูุฒุฉ ููุฑุจุงุฆูุฉ' => ['ุณุดูุงุฑ', 'ููุฑ ุดุนุฑ', 'ูุงูููุฉ ุญูุงูุฉ', 'ูููุงุฉ ุดุนุฑ', 'ูุงุณุญ ููุฑุจุงุฆู', 'ูุฏูู ููุฑุจุงุฆู'],
    'ููุงุชู ูุญูููุฉ' => ['ูุงุชู 64GB', 'ูุงุชู 128GB', 'ูุงุชู 256GB', 'ูุงุชู 512GB', 'ูุงุชู 5G', 'ูุงุชู Pro Max'],
    'ููุญูุงุช' => ['ุณูุงุนุฉ ุจููุชูุซ', 'ุดุงุญู ุณุฑูุน', 'ูุงุจู ุดุญู', 'ุฌุฑุงุจ ููุจุงูู', 'ูุงูู ุดุงุดุฉ', 'ุจุงูุฑ ุจุงูู', 'ุณุงุนุฉ ุฐููุฉ'],
    'ุฃุฌูุฒุฉ ูุทุจุฎ' => ['ุฎูุงุท ูุฏูู', 'ููุฏ ุจุฑูุณูุณูุฑ', 'ุนุฌุงูุฉ', 'ููุงูุฉ ููุงุฆูุฉ', 'ูุญุถุฑ ุทุนุงู', 'ูุงูููุฉ ูุงูู', 'ุตุงูุนุฉ ุฎุจุฒ'],
    'ุดุงุดุงุช ูุชููุฒูููุงุช' => ['ุดุงุดุฉ 32 ุจูุตุฉ', 'ุดุงุดุฉ 43 ุจูุตุฉ', 'ุดุงุดุฉ 50 ุจูุตุฉ', 'ุดุงุดุฉ 55 ุจูุตุฉ OLED', 'ุดุงุดุฉ 65 ุจูุตุฉ', 'ุดุงุดุฉ ููุจููุชุฑ'],
    'ุซูุงุฌุงุช ููุฌูุฏุงุช' => ['ุซูุงุฌุฉ ูููุฑูุณุช', 'ุฏูุจ ูุฑูุฒุฑ', 'ุซูุงุฌุฉ ูููู ุจุงุฑ', 'ูุฑูุฒุฑ ุฃููู', 'ุซูุงุฌุฉ ูุฑูุด ุฏูุฑ'],
    'ููููุงุช' => ['ูููู ุณุจููุช', 'ูููู ุดุจุงู', 'ูููู ูุชููู', 'ูููู ูุงุณูุช', 'ูููู ูุฎูู'],
];

$defaultTypes = ['ุฌูุงุฒ', 'ููุชุฌ', 'ููุฏูู', 'ููุน', 'ุงุตุฏุงุฑ'];

$features = [
    'ุณูุงุฑุช', 'ุฏูุฌูุชุงู', 'ุงููุฑุชุฑ', 'ุงูุชููุงุชูู', 'ุจุฑูููุดูุงู', 'ุงููู', 'ุชุฑุจู', 'ุณูุจุฑ', 'ุงูุชุฑุง', 
    'ุจุฑููููู', 'ุณุชุงููุณ ุณุชูู', 'LED', 'LCD', 'OLED', 'ูููุฑูุณุช', 'ุจูุงุฒูุง', 'WiFi', 'ุจููุชูุซ',
    'ุนุงูู ุงูููุงุกุฉ', 'ูููุฑ ููุทุงูุฉ', 'ุตุงูุช', 'ุณุฑูุน', 'ูุชุนุฏุฏ ุงููุธุงุฆู', 'ุชุญูู ุนู ุจุนุฏ', 'ุดุงุดุฉ ุชุงุชุด'
];

$colors = ['ุฃุจูุถ', 'ุฃุณูุฏ', 'ูุถู', 'ุฐูุจู', 'ุฑูุงุฏู', 'ุฃุฒุฑู', 'ุฃุญูุฑ', 'ุจูู'];

// ุตูุฑ ุนุดูุงุฆูุฉ ูู Lorem Picsum
function getRandomImageUrl($categoryName) {
    $seed = rand(1, 1000);
    // ูุณุชุฎุฏู ุฃุฑูุงู ุนุดูุงุฆูุฉ ูุถูุงู ุตูุฑ ูุฎุชููุฉ
    return "https://picsum.photos/seed/{$seed}/400/400";
}

// ุชูุฒูู ุตูุฑุฉ
function downloadImage($url, $filepath) {
    $context = stream_context_create([
        'http' => ['timeout' => 10, 'user_agent' => 'Mozilla/5.0'],
        'ssl' => ['verify_peer' => false, 'verify_peer_name' => false]
    ]);
    
    $imageContent = @file_get_contents($url, false, $context);
    
    if ($imageContent && strlen($imageContent) > 1000) {
        file_put_contents($filepath, $imageContent);
        return true;
    }
    return false;
}

// ุชูููุฏ ุงุณู ููุชุฌ ุนุดูุงุฆู
function generateProductName($categoryName, $brands, $productTypes, $features, $colors) {
    global $defaultBrands, $defaultTypes;
    
    $brandList = isset($brands[$categoryName]) ? $brands[$categoryName] : $defaultBrands;
    $typeList = isset($productTypes[$categoryName]) ? $productTypes[$categoryName] : $defaultTypes;
    
    $brand = $brandList[array_rand($brandList)];
    $type = $typeList[array_rand($typeList)];
    $feature = $features[array_rand($features)];
    $color = rand(0, 1) ? ' ' . $colors[array_rand($colors)] : '';
    
    $modelNumber = rand(100, 9999);
    
    return "{$type} {$brand} {$feature}{$color} ููุฏูู {$modelNumber}";
}

// ุชูููุฏ ูุตู ุงูููุชุฌ
function generateDescription($name, $categoryName) {
    $descriptions = [
        "ููุชุฌ {$name} ุจุฌูุฏุฉ ุนุงููุฉ ูุชุตููู ุนุตุฑู. ูุชููุฒ ุจุงููุชุงูุฉ ูุงูููุงุกุฉ ุงูุนุงููุฉ. ููุงุณุจ ููุงุณุชุฎุฏุงู ุงููููู.",
        "{$name} - ุงูุงุฎุชูุงุฑ ุงูุฃูุซู ููููุงุฒู ุงูุนุตุฑูุฉ. ุชูููุฉ ูุชุทูุฑุฉ ูุฃุฏุงุก ูุชููุฒ. ุถูุงู ุดุงูู.",
        "ุงุญุตู ุนูู {$name} ุจุฃูุถู ุณุนุฑ. ููุชุฌ ุฃุตูู ูุน ุถูุงู ุงููููู. ุชูุตูู ุณุฑูุน ูุฌููุน ุงูููุงุทู.",
        "{$name} ูู ุฃูุถู ุงูููุชุฌุงุช ูู ูุฆุฉ {$categoryName}. ุฌูุฏุฉ ููุชุงุฒุฉ ูุณุนุฑ ููุงูุณ.",
        "ููุชุฌ {$name} ุงูุฌุฏูุฏ ูููุงู. ุชุตููู ุฃููู ูุฃุฏุงุก ููู. ูุซุงูู ููุนุงุฆูุงุช.",
    ];
    
    return $descriptions[array_rand($descriptions)];
}

// ุชูููุฏ ุณุนุฑ ุนุดูุงุฆู ุจูุงุกู ุนูู ุงูุชุตููู
function generatePrice($categoryName) {
    $priceRanges = [
        'ุฃุฌูุฒุฉ ููุฒููุฉ' => [500, 8000],
        'ุจูุชุงุฌุงุฒุงุช' => [3000, 15000],
        'ุชููููุงุช' => [8000, 30000],
        'ุชููุฒูููุงุช' => [4000, 40000],
        'ุซูุงุฌุงุช' => [8000, 35000],
        'ุณุฎุงูุงุช' => [1500, 8000],
        'ุบุณุงูุงุช' => [6000, 25000],
        'ูุงุจุชูุจุงุช' => [10000, 80000],
        'ููุจุงููุงุช' => [3000, 70000],
        'ูููุฑูููู' => [1500, 8000],
        'ุฃุฌูุฒุฉ ููุฑุจุงุฆูุฉ' => [200, 5000],
        'ููุงุชู ูุญูููุฉ' => [2000, 60000],
        'ููุญูุงุช' => [50, 3000],
        'ุฃุฌูุฒุฉ ูุทุจุฎ' => [500, 10000],
        'ุดุงุดุงุช ูุชููุฒูููุงุช' => [3000, 50000],
        'ุซูุงุฌุงุช ููุฌูุฏุงุช' => [5000, 30000],
        'ููููุงุช' => [7000, 35000],
    ];
    
    $range = isset($priceRanges[$categoryName]) ? $priceRanges[$categoryName] : [1000, 20000];
    
    // ุชูุฑูุจ ุงูุณุนุฑ ูุฃูุฑุจ 50
    $price = rand($range[0], $range[1]);
    return round($price / 50) * 50;
}

$productsPerCategory = 250;
$totalProducts = 0;
$totalImages = 0;
$batchSize = 50; // ุฅุถุงูุฉ 50 ููุชุฌ ูู ูู ุฏูุนุฉ ุซู ูุนุฑุถ ุงูุชูุฏู

// ุจุฏุก ุงููุนุงููุฉ ููุฃุฏุงุก
echo "๐ ุจุฏุก ุฅุถุงูุฉ ุงูููุชุฌุงุช...\n\n";

foreach ($categories as $category) {
    $categoryId = $category['id'];
    $categoryName = $category['name'];
    
    echo "๐ {$categoryName} (ID: {$categoryId})\n";
    echo "   ุฅุถุงูุฉ {$productsPerCategory} ููุชุฌ...\n";
    
    $categoryProducts = 0;
    $categoryImages = 0;
    
    $pdo->beginTransaction();
    
    for ($i = 1; $i <= $productsPerCategory; $i++) {
        // ุชูููุฏ ุจูุงูุงุช ุงูููุชุฌ
        $name = generateProductName($categoryName, $brands, $productTypes, $features, $colors);
        $description = generateDescription($name, $categoryName);
        $cashPrice = generatePrice($categoryName);
        $installmentPrice = round($cashPrice * 1.15 / 50) * 50; // ุฒูุงุฏุฉ 15% ููุชูุณูุท
        $costPrice = round($cashPrice * 0.7 / 50) * 50;
        $quantity = rand(5, 100);
        $minQuantity = rand(3, 10);
        $barcode = '50' . str_pad(rand(1, 9999999999), 10, '0', STR_PAD_LEFT);
        $sku = 'SKU-' . strtoupper(substr(md5(uniqid()), 0, 8));
        $warranty = rand(0, 1) ? rand(6, 36) : 0;
        
        // ุชูุฒูู ุตูุฑุฉ (ูููู ุนุฏุฏ ุงูุตูุฑ ูุชุณุฑูุน ุงูุนูููุฉ)
        $imageFilename = null;
        if ($i <= 10 || rand(1, 5) === 1) { // ููุท ุฃูู 10 ููุชุฌุงุช + 20% ูู ุงูุจุงูู
            $imageUrl = getRandomImageUrl($categoryName);
            $imageFilename = 'product_' . md5($name . $i) . '.jpg';
            $imagePath = $uploadsDir . '/' . $imageFilename;
            
            if (downloadImage($imageUrl, $imagePath)) {
                $categoryImages++;
            } else {
                $imageFilename = null;
            }
        }
        
        // ุฅุถุงูุฉ ุงูููุชุฌ
        $stmt = $pdo->prepare("
            INSERT INTO products 
            (name, description, category_id, barcode, sku, cash_price, installment_price, cost_price, 
             quantity, min_quantity, image, warranty_months, is_active, created_at, updated_at) 
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1, datetime('now'), datetime('now'))
        ");
        
        $stmt->execute([
            $name, $description, $categoryId, $barcode, $sku, 
            $cashPrice, $installmentPrice, $costPrice,
            $quantity, $minQuantity, $imageFilename, $warranty
        ]);
        
        $categoryProducts++;
        
        // ุนุฑุถ ุงูุชูุฏู ูู 50 ููุชุฌ
        if ($i % $batchSize === 0) {
            echo "   โ {$i}/{$productsPerCategory}\n";
        }
    }
    
    $pdo->commit();
    
    $totalProducts += $categoryProducts;
    $totalImages += $categoryImages;
    
    echo "   โ ุชู ุฅุถุงูุฉ {$categoryProducts} ููุชุฌ ({$categoryImages} ุตูุฑุฉ)\n\n";
}

echo "==============================================\n";
echo "   โ ุงูุชููุช ุงูุนูููุฉ ุจูุฌุงุญ!\n";
echo "==============================================\n";
echo "๐ฆ ุฅุฌูุงูู ุงูููุชุฌุงุช ุงููุถุงูุฉ: {$totalProducts}\n";
echo "๐ผ๏ธ  ุฅุฌูุงูู ุงูุตูุฑ ุงููุญููุฉ: {$totalImages}\n";
echo "๐ ุนุฏุฏ ุงูุชุตูููุงุช: " . count($categories) . "\n";
echo "๐ ูุชูุณุท ุงูููุชุฌุงุช ููู ุชุตููู: " . round($totalProducts / count($categories)) . "\n";
